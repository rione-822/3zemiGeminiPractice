## 広告表示機能のデバッグと改善の経緯

### 1. 当初の目的

最初の広告をユーザーが閉じた後、時間差で2つ目の広告をフェードインで表示させる。

### 2. 発生した問題

実装後、最初の広告の「×」ボタンをクリックしても広告が消えなくなる不具合が発生した。

### 3. 調査と試行の過程

#### 仮説1：HTML要素のIDの重複
当初、2つの広告で同じ`id="ad-content"`を使用していたため、これが原因と推測。`id`はページ内で一意であるべきというHTMLのルールに基づき、`id`を`class`に変更した。
**結果：** 状況は改善されなかった。

#### 仮説2：JavaScriptの非同期処理とコードの一貫性
次に、`setTimeout`という非同期処理が影響している可能性を検討。表示・非表示の制御方法が、最初の広告(`style.display`)と2つ目の広告(`classList`)で異なっていたため、これを`classList`を使う方法に統一した。
**結果：** これでも問題は解決しなかった。

### 4. 根本原因の特定

**2つ目の広告要素(`ad-container-2`)が、透明(`opacity: 0`)な状態で最初から画面全体を覆っていたため、その下にある最初の広告の「×」ボタンへのクリック操作を妨げていた。**

CSSで`opacity: 0`に設定しても、要素はそこに「存在」し続けており、クリックなどのイベントを受け取ってしまう。`z-index`が2つ目の広告の方が高かったため、全てのクリックが手前にある透明な広告に吸い取られていたことが根本的な原因だった。

### 5. 最終的な解決策

広告の表示・非表示を管理するCSSの仕組みを全面的に見直した。

1.  **CSSの`visibility`プロパティの活用:**
    *   非表示用の`.hidden`クラスに、`opacity: 0`だけでなく`visibility: hidden`を追加した。
    *   `visibility: hidden`が設定された要素は、レンダリングツリーから取り除かれ、クリックなどのイベントを受け取らなくなる。これにより、クリックが妨げられる問題を解決した。

2.  **JavaScriptのロジックの簡素化:**
    *   ページの読み込み時に、まず2つ目の広告に`.hidden`クラスを付与して非表示状態にする。
    *   最初の広告の「×」ボタンがクリックされたら、最初の広告に`.hidden`クラスを付与し、`setTimeout`で遅延させた後に、2つ目の広告から`.hidden`クラスを削除する。
    *   この方法により、両方の広告の表示・非表示が単一のクラス(`.hidden`)の付け外しだけで制御されるようになり、コードの可読性と保守性が向上した。

### 6. まとめ

今回のデバッグから、**透明な要素であっても、レイアウト上の位置や重なり順（z-index）によっては、他の要素の操作を妨げる可能性がある**という重要な教訓を得た。要素を完全に非表示にし、イベントを受け取らないようにするためには、`display: none`や`visibility: hidden`を適切に使うことが不可欠である。
